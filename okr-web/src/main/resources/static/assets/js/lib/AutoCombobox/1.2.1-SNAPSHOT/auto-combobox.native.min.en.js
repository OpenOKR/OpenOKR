(function($,undefined){$.autoCombo=$.autoCombo||{defaultConfig:{}};var _defaultColModel={isQueryField:false,isHide:false,width:60,isInputFilter:true},_defaultConfig={event:{isIgnoreRelatedTarget:false,actionEvents:"click.auto-combobox mousedown.auto-combobox focus.auto-combobox",lossEventsForWindow:"click.auto-combobox mousedown.auto-combobox scroll.auto-combobox",lossEventsForSelf:"blur.auto-combobox"},view:{singleColumnNotHead:false,forceHideHead:false,showPager:true,pagerPosition:"bottom",pageSize:10,height:0,width:0,minWidth:220,isSelectedFirstRow:true,isSelectedFirstRowAction:false,isRememberValue:true,isAllowEmpty:true,isOnActionIgnoreFilter:true,isAllowReadonlyAction:true,bindFill:{},colModels:[],dataGridHtmlTemplate:null,templateSettings:{interpolate:/##(.+?)##/g},pagerBarHtmlTemplate:'<div class="auto-comboBox-pager" id="<%=pagerId%>"><table><tbody><tr><td class="auto-comboBox-pager-btn" id="<%=firstPageBtnId%>"><span class="first"></span></td><td class="auto-comboBox-pager-btn" id="<%=prevPageBtnId%>"><span class="prev"></span></td><td style="padding: 0;"><input type="text" style="width: 20px;height: 16px" readonly="readonly" value="<%=currentPage%>" /></td><td class="auto-comboBox-pager-btn" id="<%=nextPageBtnId%>"><span class="next"></span></td><td class="auto-comboBox-pager-btn" id="<%=lastPageBtnId%>"><span class="end"></span></td><td>###pageInfoFormat###</td></tr></tbody></table></div>',localData:[],zIndex:9999,positionRefer:null,dropDownContainer:null,autoLoad:true,autoHeightPadding:-1,widthRefer:null,dropDownWithin:"body",isHighlight:true,isEncode:false,showClearButton:false},callback:{beforeAction:null,afterAction:null,beforeLose:null,afterLose:null,beforeAjaxBeforeSend:null,beforeAjaxSuccess:null,afterAjaxError:null,beforeSelectRow:null,afterSelectRow:null,beforeInput:null,afterInput:null,beforeKeyDown:null,afterKeyDown:null,setRequestData:null,afterLoad:null,afterClickClear:null},async:{url:"",type:"POST",dataType:"json",dataSourceType:"remote",async:true,requestData:{},pageFieldDefine:{pageSize:"pageSize",totalRecord:"totalRecord",currentPage:"currentPage",totalPage:"totalPage",records:"records"}},input:{queryDelay:200,enableInputAction:true,inputQueryParamName:"inputValue",enableAutoComplete:false}};var _otherProperty={isDropDownShow:false,currentSelectedRowId:null,_dropDown:null,_dataPanel:null,_isBindEventDataPanel:false,_originalDataStore:[],_inputFilterFieldNames:[],_showFieldNames:[],_formatterMap:{},_totalColWidth:0,_isLoaded:false,_actionStop:true,_focusRowIndex:-1,_maxHeight:200,_minHeight:160,_isCurrentValueFromDataGrid:false,_rememberValue:"",_justReload:false,_isMouseOutDropDown:true,_isMouseOverClearBtn:true,_isSettedLocalData:false};$.fn.AutoCombobox=function(config){if(typeof config==="string"){var fn=$.autoCombo.getAccessor($.autoCombo,config);if(!fn){alert("AutoCombobox method not found:"+config);return}else{if(config.indexOf("_")===0){alert("AutoCombobox don't call the private method:"+config);return}}var args=$.makeArray(arguments).slice(1);return fn.apply(this,args)}return this.each(function(){if(this.renderCompleted){return}var _thisElm=this,p;_thisElm.componentType="AutoCombobox";if(!$(_thisElm).is("input:text, textarea")){alert("#"+_thisElm.id+"[name='"+_thisElm.name+"']Non(input:text)controls can't initialize!");return}_thisElm.p=$.extend(true,{},{id:_thisElm.id?_thisElm.id:"_"+parseInt((Math.random()*100000000))},_otherProperty,$.autoCombo);p=_thisElm.p;_thisElm.id=p.id;p.event=$.extend(true,{},_defaultConfig.event,$.autoCombo.defaultConfig.event,config.event);p.view=$.extend(true,{},_defaultConfig.view,$.autoCombo.defaultConfig.view,config.view);p.callback=$.extend(true,{},_defaultConfig.callback,$.autoCombo.defaultConfig.callback,config.callback);p.async=$.extend(true,{},_defaultConfig.async,$.autoCombo.defaultConfig.async,config.async);p.input=$.extend(true,{},_defaultConfig.input,$.autoCombo.defaultConfig.input,config.input);if($.isFunction(p.callback.beforeInput)&&App&&App.hasOwnProperty("src")&&App.src===true){_printWarnLog("p.callback.beforeInput 后续版本将不支持，推荐使用 p.callback.beforeKeyDown")}if($.isFunction(p.callback.afterInput)&&App&&App.hasOwnProperty("src")&&App.src===true){_printWarnLog("p.callback.afterInput 后续版本将不支持，推荐使用 p.callback.afterKeyDown")}var $container=$(p.view.dropDownContainer);if($container&&$container.length>0&&$container[0].id===(p.id+"DropDown")&&App&&App.hasOwnProperty("src")&&App.src===true){_printWarnLog("配置项p.view.dropDownContainer="+p.view.dropDownContainer+"，对应的元素id不能命名为（"+p.id+"DropDown）建议改为（"+p.id+"Container）")}p.view.pagerBarHtmlTemplate=p.view.pagerBarHtmlTemplate.replace("###pageInfoFormat###",$.autoCombo.i18n.pageInfoFormat);p.async.requestData[p.async.pageFieldDefine.pageSize]=p.view.pageSize;p.async.requestData[p.async.pageFieldDefine.totalRecord]=-1;p.async.requestData[p.async.pageFieldDefine.currentPage]=1;if(p.input.enableAutoComplete){_thisElm.autocomplete="on"}else{_thisElm.autocomplete="off"}_initial.call(_thisElm);_thisElm.renderCompleted=true})};$.extend($.autoCombo,{getAccessor:function(obj,expr){var ret,p,prm=[],i;if(typeof expr==="function"){return expr(obj)}ret=obj[expr];if(ret===undefined){try{if(typeof expr==="string"){prm=expr.split(".")}i=prm.length;if(i){ret=obj;while(ret&&i--){p=prm.shift();ret=ret[p]}}}catch(e){}}return ret},triggerAction:function(event){return $(this).each(function(){var _thisElm=this,p=_thisElm.p,$this=$(_thisElm);if($this.prop("disabled")===false){if($this.prop("readonly")===false||p.view.isAllowReadonlyAction){if(!p._isLoaded){_onAction.call(_thisElm,event)}else{p.showDropDown.call(_thisElm,true);window.event.cancelBubble=true;window.event.stopPropagation()}}}})},showDropDown:function(_isDropDownShow){$(this).each(function(){var _thisElm=this,p=_thisElm.p,$this=$(_thisElm),$c=p._dropDown,$positionRefer;p.isDropDownShow=_isDropDownShow;if($c===null){return}if(_isDropDownShow){$c.show();if(p.view.dropDownContainer){_resizeDropDown.call(_thisElm)}else{if($this.length===0||$this.is(":hidden")){return}$c.css({left:"-9999px",top:"-9999px",position:"absolute","z-index":p.view.zIndex});var _afterShow=function(){_resizeDropDown.call(_thisElm);var _showTimeObj=window.setTimeout(function(){if($c.offset().left<0&&$c.offset().top<0){$positionRefer=_getPositionRefer.call(_thisElm);var _checkShowTimeObj=window.setTimeout(function(){if($this.length===0||$this.is(":hidden")){$c.hide();p.isDropDownShow=false}else{$c.positioner({my:"left top",at:"left bottom",of:$positionRefer,collision:"flipfit flipfit"});p.isDropDownShow=true;_showCurrentSelectedRow.call(_thisElm);if(p.callback.afterAction){p.callback.afterAction.call(_thisElm,event)}}window.clearTimeout(_checkShowTimeObj)},1)}else{p.isDropDownShow=false}window.clearTimeout(_showTimeObj)},1)};_afterShow()}}else{if(p.view.isRememberValue===true&&(p.view.isAllowEmpty===false||$.trim($this.val()).length!==0)){if(p._isCurrentValueFromDataGrid===false){$this.val(p._rememberValue);p._justReload=true;if(!p.view.isOnActionIgnoreFilter){_reloadByValue.call(_thisElm,$this.val())}else{_reloadByValue.call(_thisElm,"")}}}if(p.view.dropDownContainer){}else{$c.hide();window.setTimeout(function(){if($c.offset().left>=0&&$c.offset().top>=0){$c.css({left:"-9999px",top:"-9999px",position:"absolute","z-index":-9999});p.isDropDownShow=false}else{p.isDropDownShow=true}},1)}}})},hideDropDown:function(){var _thisElm=this,p=_thisElm.p;p._actionStop=true;p.showDropDown.call(_thisElm,false)},showLoadingBar:function(){var _thisElm=this,p=_thisElm.p,$this=$(_thisElm),_thisElmTop=$this.offset().top,_thisElmLeft=$this.offset().left;if(p._loadingBar.is(":hidden")){p._loadingBar.css({top:-9999,left:-9999}).show(function(){$(this).css({top:_thisElmTop+"px",left:_thisElmLeft+"px",display:"block","z-index":p.view.zIndex})})}},hideLoadingBar:function(){if(!this.p._loadingBar.is(":hidden")){this.p._loadingBar.hide(function(){$(this).css({display:"none","z-index":-9999})})}},destroy:function(){return $(this).each(function(){var _thisElm=this,$this=$(_thisElm),windowEvent,p=_thisElm.p;if(_thisElm.p){$this.off(p.event.actionEvents+p.id);$this.off("keydown."+p.id);windowEvent=_splitEventString.call(_thisElm,p.event.lossEventsForWindow,p.id);$(window.document).off(windowEvent);$this.off(p.event.lossEventsForSelf+p.id);p._dataPanel.off("mousedown."+p.id);p._dataPanel.off("keyup."+p.id);_thisElm.renderCompleted=false;_thisElm.p=null}})},reload:function(){return $(this).each(function(){var _thisElm=this,p=_thisElm.p;p.currentSelectedRowId=null;_onLoad.call(this)})},setLocalData:function(data){return $(this).each(function(){var _thisElm=this,p=_thisElm.p;if($.isArray(data)){p._originalDataStore=$.extend(true,[],data);p.view.localData=p._originalDataStore;p._isSettedLocalData=true;p._focusRowIndex=-1;p._isLoaded=false;_setRowId.call(_thisElm,p._originalDataStore);if(p.view.dropDownContainer){_onLocal.call(_thisElm)}}})},clearLocalData:function(){return $(this).each(function(){this.p._originalDataStore=this.p.view.localData=[]})},getLocalData:function(){return this[0].p._originalDataStore},getCurrentSelectedRowData:function(){var rowData={};$(this).each(function(){var _thisElm=this,p=_thisElm.p;rowData=_getRowData.call(_thisElm,p.currentSelectedRowId)});return rowData},clearValue:function(event){return $(this).each(function(){var _thisElm=this,p=_thisElm.p,$this=$(_thisElm),bindFill=p.view.bindFill,selector;if(p.view.showClearButton){if($.trim($this.val()).length>0){if(!$.isEmptyObject(bindFill)){for(selector in bindFill){if(bindFill[selector]){$(selector).val("")}}}else{$this.val("")}if($.isFunction(p.callback.afterClickClear)){p.callback.afterClickClear.call(_thisElm,event)}}_hideClearButton.call(_thisElm,event)}})}});var _dataSourceType={l:"local",o:"onceRemote",r:"remote"},_initial=function(){$(this).each(function(){var _thisElm=this,$this=$(_thisElm),p=_thisElm.p,windowEvent;windowEvent=_splitEventString.call(_thisElm,p.event.lossEventsForWindow,p.id);$this.off(p.event.actionEvents+p.id);$this.on(p.event.actionEvents+p.id,function(event){_onAction.call(_thisElm,event);_showClearButton.call(_thisElm)});$this.off("keydown.auto-combobox"+p.id);$this.on("keydown.auto-combobox"+p.id,_onKeyDown);$(window.document).off(windowEvent);$(window.document).on(windowEvent,function(){_onLose.apply(_thisElm,arguments);p._isMouseOverClearBtn=false;_hideClearButton.call(_thisElm,event)});$this.off(p.event.lossEventsForSelf+p.id);$this.on(p.event.lossEventsForSelf+p.id,function(event){_onLose.apply(_thisElm,arguments);_hideClearButton.call(_thisElm,event)});_calculateInfo.call(_thisElm);if(p._dropDown===null){_createDropDown.call(_thisElm)}if($.trim($this.val()).length>0&&p.view.isRememberValue===true){p._isCurrentValueFromDataGrid=true;p._rememberValue=$this.val()}if(p.view.dropDownContainer&&p.view.autoLoad){p.triggerAction.call(_thisElm)}})},_splitEventString=function(eventString,suffix){var eventStr=eventString,eventArr;if($.trim(eventString).length>0){eventArr=eventString.split(" ");if($.isArray(eventArr)){eventStr=eventArr.join(suffix+" ");eventStr+=suffix+" "}}return eventStr},_onAction=function(event){var _thisElm=this,p=_thisElm.p,$this=$(_thisElm);if(p._actionStop===true){p._actionStop=false}else{return}if(!p.event.isIgnoreRelatedTarget){if(event&&event.type==="focus"){if(event.relatedTarget){}else{p._actionStop=true;return}}}if(p==null){p._actionStop=true;return}if(p.isDropDownShow){p._actionStop=true;return}if($this.prop("readonly")===true&&!p.view.isAllowReadonlyAction){p._actionStop=true;return}if($this.val()&&p.view.isRememberValue===true){p._isCurrentValueFromDataGrid=true;p._rememberValue=$this.val()}if(p.callback.beforeAction&&p.callback.beforeAction.call(_thisElm,event)===false){p._actionStop=true;return}if(!p._isLoaded){p.reload.call(_thisElm)}else{if(!p.view.isOnActionIgnoreFilter){_reloadByValue.call(_thisElm,$this.val())}else{_reloadByValue.call(_thisElm,"")}}if(p.callback.afterAction){p.callback.afterAction.call(_thisElm,event)}},_onKeyDown=function(event){var _thisElm=this,p=_thisElm.p,$this=$(_thisElm),selector,bindFill=p.view.bindFill,rowIdAttrName=getDataGridRowIdAttributeName.call(_thisElm);if((p.callback.beforeKeyDown&&p.callback.beforeKeyDown.call(_thisElm,event)===false)||(p.callback.beforeInput&&p.callback.beforeInput.call(_thisElm,event)===false)){return}if(event&&event.keyCode){if((event.keyCode>=48&&event.keyCode<=57)||(event.keyCode>=65&&event.keyCode<=90)||event.keyCode===8||event.keyCode===32||event.keyCode===46||(event.keyCode>=96&&event.keyCode<=111)||(event.keyCode>=186&&event.keyCode<=192)||(event.keyCode>=219&&event.keyCode<=222)||event.keyCode===229){p._isCurrentValueFromDataGrid=false;if(p.input.enableInputAction===true){window.clearTimeout(p._inputQueryTimeobj);p._inputQueryTimeobj=window.setTimeout(function(){p.async.requestData[p.async.pageFieldDefine.currentPage]=1;_reloadByValue.call(_thisElm,$this.val());if(p.view.showClearButton){if($.trim($this.val()).length>0){_showClearButton.call(_thisElm)}else{_hideClearButton.call(_thisElm)}}},p.input.queryDelay)}}if(event.keyCode===40||event.keyCode===38){if(!p.isDropDownShow){p.showDropDown.call(_thisElm,true)}var $dataGridTrs=p._dataPanel.find("tr["+rowIdAttrName+"]");if($dataGridTrs&&$dataGridTrs.length>0){if(event.keyCode===40){if(p._focusRowIndex===0||p._focusRowIndex>0){if(p._focusRowIndex<$dataGridTrs.length-1){p._focusRowIndex+=1}else{if(p.view.showPager){_onClickDataPanel.call(_thisElm,getNextPageBtnId.call(_thisElm))}p._focusRowIndex=0}}else{p._focusRowIndex=0}}if(event.keyCode===38){if(p._focusRowIndex===0||p._focusRowIndex>0){if(p._focusRowIndex>0){p._focusRowIndex-=1}else{if(p.view.showPager){_onClickDataPanel.call(_thisElm,getPrevPageBtnId.call(_thisElm))}p._focusRowIndex=$dataGridTrs.length-1}}else{p._focusRowIndex=$dataGridTrs.length-1}}_setSelectedRowEffect.call(_thisElm,$dataGridTrs)}}if(event.keyCode===13||event.keyCode===9){if(!p.isDropDownShow){return}else{var $trElem=p._dataPanel.find("tr.selected["+rowIdAttrName+"]");if($trElem&&$trElem.length===1){_onSelectRow.call(_thisElm,event,$trElem.attr(rowIdAttrName))}if($.isFunction(p.callback.afterKeyDown)){p.callback.afterKeyDown.call(_thisElm,event)}else{if($.isFunction(p.callback.afterInput)){p.callback.afterInput.call(_thisElm,event)}}}}}$this.off("keyup").on("keyup",function(){if($.trim($this.val()).length===0){for(selector in bindFill){if(bindFill[selector]){$(selector).val("")}}}if($.isFunction(p.callback.afterKeyDown)){p.callback.afterKeyDown.call(_thisElm,event)}else{if($.isFunction(p.callback.afterInput)){p.callback.afterInput.call(_thisElm,event)}}})},_onLose=function(event){var target=event?event.target:{},_thisElm=this,p=_thisElm.p;if(target==_thisElm&&event.type!=="blur"){return}if(p==null){return}if(!p.isDropDownShow||p.view.dropDownContainer){return}if(p.callback.beforeLose&&p.callback.beforeLose.call(_thisElm,event)===false){return}if(p._isMouseOutDropDown!==true){return}p.hideLoadingBar.call(_thisElm);p.hideDropDown.call(_thisElm);if(p.callback.afterLose){p.callback.afterLose.call(_thisElm,event)}},_createDropDown=function(){var _thisElm=this,p=_thisElm.p,cid=p.id+"DropDown",$dpc=$(p.view.dropDownContainer);p._dropDown=$("#"+cid);if(p._dropDown&&p._dropDown.length>0){}else{if($dpc&&$dpc.length>0){p._dropDown=$dpc.addClass("auto-comboBox-dropDown").css({width:p.view.width,height:p.view.height});p._dropDown.show()}else{p._dropDown=$('<div id="'+cid+'" class="auto-comboBox-dropDown" ></div>');$(p.view.dropDownWithin).append(p._dropDown)}}if(p._dataPanel&&p._dataPanel.length>0){}else{p._dropDown.append(_createDataPanel.call(_thisElm))}if(p._loadingBar&&p._loadingBar.length>0){}else{_createLoadingBar.call(_thisElm)}if(p.view.showClearButton){if(p._clearBtn&&p._clearBtn.length>0){}else{_createClearButton.call(_thisElm)}}_bindDropDownEvents.call(_thisElm);return p._dropDown},_bindDropDownEvents=function(){var _thisElm=this,p=_thisElm.p,view=p.view;if(p._isBindEventDropDown){return}p._dropDown.off("mouseover.auto-combobox"+p.id);p._dropDown.off("mouseout.auto-combobox"+p.id);p._dropDown.on("mouseover.auto-combobox"+p.id,function(event){_mouseOverDropDown.call(_thisElm,event)});p._dropDown.on("mouseout.auto-combobox"+p.id,function(event){_mouseOutDropDown.call(_thisElm,event)});if(view.dropDownContainer&&(view.autoHeightPadding>-1||view.autoHeightPadding>-1)){var timeOutHeightObj=-1,$window=$(window);$window.off("resize.auto-combobox"+p.id);$window.on("resize.auto-combobox"+p.id,function(event){window.clearTimeout(timeOutHeightObj);timeOutHeightObj=window.setTimeout(function(){view.height=$.oui.utils.element.getHeightToBottom(view.dropDownContainer,view.autoHeightPadding);if(view.height<=p._minHeight){view.height=p._minHeight}p._dropDown.height(view.height);_resizeDropDown.call(_thisElm,true);window.clearTimeout(timeOutHeightObj)},300)})}p._isBindEventDropDown=true},_mouseOverDropDown=function(){this.p._isMouseOutDropDown=false},_mouseOutDropDown=function(){this.p._isMouseOutDropDown=true},_createLoadingBar=function(){var _thisElm=this,p=_thisElm.p,lbid=p.id+"LoadingBar";p._loadingBar=$("#"+lbid);if(p._loadingBar&&p._loadingBar.length>0){}else{p._loadingBar=$('<div id="'+lbid+'" style="display: none;position: absolute;top: 0;left: 0;"><div class="auto-comboBox-loadingbar-img"></div></div>');$(document.body).append(p._loadingBar)}},_createClearButton=function(){var _thisElm=this,p=_thisElm.p,cbId=p.id+"ClearBtn";p._clearBtn=$("#"+cbId);if(p._clearBtn&&p._clearBtn.length>0){}else{p._clearBtn=$('<div id="'+cbId+'" style="background-color: #FFFFFF;height:18px;width:18px;display: none;position: absolute;top: 0;left: 0;" title="'+$.autoCombo.i18n.clearButtonTitle+'" onmousedown="$(\'#'+p.id+"').AutoCombobox('clearValue',event);\"><div class=\"auto-comboBox-clear-img\"></div></div>");$(document.body).append(p._clearBtn);p._clearBtn.off("mouseover.auto-combobox").on("mouseover.auto-combobox"+p.id,function(){p._isMouseOverClearBtn=true}).off("mouseout.auto-combobox").on("mouseout.auto-combobox"+p.id,function(){p._isMouseOverClearBtn=false})}},_showClearButton=function(){var _thisElm=this,p=_thisElm.p,$this=$(_thisElm);if(p._clearBtn&&p._clearBtn.length>0&&$.trim($this.val()).length>0){var _thisElmTop=$this.offset().top,_thisElmLeft=$this.offset().left,height=$this.outerHeight(),width=$this.outerWidth(),clearImgBoxWH=18,clearImgWH=12,paddingH=(height-clearImgBoxWH)/2;if(p._clearBtn&&p._clearBtn.length>0){p._clearBtn.css({top:(_thisElmTop+paddingH)+"px",left:(_thisElmLeft+width-clearImgBoxWH)+"px",display:"block","z-index":"9999"}).show().find("div.auto-comboBox-clear-img").css({position:"relative",top:((clearImgBoxWH-clearImgWH)/2)+"px",left:((clearImgBoxWH-clearImgWH)/2)+"px"})}}},_hideClearButton=function(event){var _thisElm=this,p=_thisElm.p;if(p._clearBtn&&p._clearBtn.length>0){if(p._isMouseOverClearBtn===false){p._clearBtn.hide()}if(event&&event.type==="mousedown"){p._clearBtn.hide()}}},_onLoad=function(){var _thisElm=this,p=_thisElm.p;$(_thisElm).each(function(){switch(p.async.dataSourceType){case _dataSourceType.r:_onRemote.call(_thisElm);break;case _dataSourceType.o:_onOnceRemote.call(_thisElm);break;case _dataSourceType.l:_onLocal.call(_thisElm);break}})},_onRemote=function(){_onAjaxRequest.call(this)},_onOnceRemote=function(){_onAjaxRequest.call(this)},_onAjaxRequest=function(){var _thisElm=this,p=_thisElm.p;if($.isFunction(p.callback.setRequestData)){p.callback.setRequestData.call(_thisElm,p.async.requestData)}if(p.async.contentType&&p.async.contentType.indexOf("application/json")>-1){p.async.data=JSON.stringify(p.async.requestData)}else{p.async.data=$.extend({},p.async.data,p.async.requestData)}$.ajax($.extend({},{success:function(data,st,xhr){_onAjaxSuccess.call(_thisElm,data,st,xhr)},error:function(xhr,st,err){_onAjaxError.call(_thisElm,xhr,st,err)},beforeSend:function(xhr,settings){return _onAjaxBeforeSend.call(_thisElm,xhr,settings)}},p.async))},_onAjaxBeforeSend=function(xhr,settings){var _thisElm=this,p=_thisElm.p,flag=true;if($.isFunction(p.callback.beforeAjaxBeforeSend)){flag=p.callback.beforeAjaxBeforeSend.call(_thisElm,xhr,settings)}p.showLoadingBar.call(_thisElm);return flag},_onAjaxSuccess=function(responseData,st,xhr){var _thisElm=this,p=_thisElm.p,$dp=p._dataPanel,dataGridHtml="",pagerBarHtml="",filterStore={},_recStore={};_thisElm.focusEvent?$(_thisElm).focus():null;if($.isFunction(p.callback.beforeAjaxSuccess)){p.callback.beforeAjaxSuccess.call(_thisElm,responseData,st,xhr)}if(p.async.dataSourceType===_dataSourceType.o){if(!$.isArray(responseData)){_onAjaxError.call(_thisElm,xhr,st,"Response data format error!");return}p._originalDataStore=$.extend(true,[],responseData);_setRowId.call(_thisElm,p._originalDataStore);_recStore[p.async.pageFieldDefine.records]=p._originalDataStore;filterStore=_format.call(_thisElm,_recStore);if(!p.view.isOnActionIgnoreFilter){filterStore=_getFilterRowDatas.call(_thisElm,_thisElm.value,filterStore)}dataGridHtml=_buildDataGridHtml.call(_thisElm,filterStore);$dp.empty().append(dataGridHtml);if(p.view.isHighlight){_setHighlightEffect.call(_thisElm,_thisElm.value)}}else{p._originalDataStore=$.extend(true,[],$.autoCombo.getAccessor(responseData,p.async.pageFieldDefine.records));if(!responseData[p.async.pageFieldDefine.records]){_onAjaxError.call(_thisElm,xhr,st,"Response data format error!");return}_setRowId.call(_thisElm,p._originalDataStore);_recStore[p.async.pageFieldDefine.records]=p._originalDataStore;filterStore=_format.call(_thisElm,_recStore);dataGridHtml=_buildDataGridHtml.call(_thisElm,filterStore);if(p.view.showPager){pagerBarHtml=_buildPagerBarHtml.call(_thisElm,responseData)}if(p.view.pagerPosition==="bottom"){$dp.empty().append(dataGridHtml).append(pagerBarHtml)}else{$dp.empty().append(pagerBarHtml).append(dataGridHtml)}if(p.view.isHighlight){_setHighlightEffect.call(_thisElm,_thisElm.value)}var asyncDataStr='{"'+p.async.pageFieldDefine.pageSize+'":'+$.autoCombo.getAccessor(responseData,p.async.pageFieldDefine.pageSize)+',"'+p.async.pageFieldDefine.currentPage+'":'+$.autoCombo.getAccessor(responseData,p.async.pageFieldDefine.currentPage)+',"'+p.async.pageFieldDefine.totalPage+'":'+$.autoCombo.getAccessor(responseData,p.async.pageFieldDefine.totalPage)+',"'+p.async.pageFieldDefine.totalRecord+'":'+$.autoCombo.getAccessor(responseData,p.async.pageFieldDefine.totalRecord)+"}";$.extend(p.async.requestData,$.parseJSON(asyncDataStr))}_setSelectedFirstRow.call(_thisElm,_thisElm.isPrePageOfKey||null);p._isLoaded=true;p._actionStop=true;p.hideLoadingBar.call(_thisElm);if($.isFunction(p.callback.afterLoad)){p.callback.afterLoad.call(_thisElm,p._originalDataStore,$dp)}if(p._justReload===false){p.showDropDown.call(_thisElm,true)}else{p._justReload=false}},_onAjaxError=function(xhr,st,err){var _thisElm=this,p=_thisElm.p;if($.isFunction(p.callback.afterAjaxError)){p.callback.afterAjaxError.call(_thisElm,xhr,st,err)}xhr=null;p._actionStop=true;p.hideLoadingBar.call(_thisElm);throw new Error("Request error:"+err)},_onLocal=function(){var _thisElm=this,p=_thisElm.p,$dp=p._dataPanel,filterStore,dataGridHtml;p.showLoadingBar.call(_thisElm);if(p._isSettedLocalData||(p._originalDataStore.length===0&&p.view.localData.length>0)){if(p._originalDataStore.length>0){p.view.localData=$.extend(true,[],p._originalDataStore)}p._originalDataStore=$.extend(true,[],p.view.localData)}_setRowId.call(_thisElm,p._originalDataStore);var _recStore={};_recStore[p.async.pageFieldDefine.records]=p._originalDataStore;filterStore=_format.call(_thisElm,_recStore);if(!p.view.isOnActionIgnoreFilter){filterStore=_getFilterRowDatas.call(_thisElm,_thisElm.value,filterStore)}dataGridHtml=_buildDataGridHtml.call(_thisElm,filterStore);$dp.empty().append(dataGridHtml);if(p.view.isHighlight){_setHighlightEffect.call(_thisElm,_thisElm.value)}p.showDropDown.call(_thisElm,true);_setSelectedFirstRow.call(_thisElm);p._isLoaded=true;if($.isFunction(p.callback.afterLoad)){p.callback.afterLoad.call(_thisElm,p._originalDataStore,$dp)}p._actionStop=true;p.hideLoadingBar.call(_thisElm)},_setRowId=function(rowDatas){var _thisElm=this,rowDataNum=0,rowData={},rowIdPropertyName=getDataRowIdPropertyName.call(_thisElm);if(rowDatas){for(;rowDataNum<rowDatas.length;rowDataNum++){rowData=rowDatas[rowDataNum];rowData[rowIdPropertyName]="id"+rowDataNum}}},_createDataPanel=function(){var _thisElm=this,p=_thisElm.p,dpId=p.id+"DataPanel";p._dataPanel=$("#"+dpId);if(p._dataPanel&&p._dataPanel.length>0){}else{p._dataPanel=$('<div id="'+dpId+'"></div>');$(document.body).append(p._dataPanel)}_bindDataPanelEvents.call(_thisElm);return p._dataPanel},_bindDataPanelEvents=function(){var _thisElm=this,p=_thisElm.p;if(p._isBindEventDataPanel){return}p._dataPanel.off("mousedown."+p.id);p._dataPanel.off("keyup."+p.id);p._dataPanel.on("mousedown."+p.id,function(event){_onClickDataPanel.call(_thisElm,event);_thisElm.focusEvent=true});p._dataPanel.on("keyup."+p.id,function(event){_onKeyupDataPanel.call(_thisElm,event)});p._isBindEventDataPanel=true},_onClickDataPanel=function(event){var _thisElm=this,p=_thisElm.p,target=event.target||null,$t=$(target)||null,rowIdAttrName=getDataGridRowIdAttributeName.call(_thisElm),rowId=$t.parents("tr").attr(rowIdAttrName)||null,$td=$t.parents("td")||null,tdId;if(rowId){_onSelectRow.call(_thisElm,event,rowId)}else{if($t.is("span")&&$td.is("td")||typeof event==="string"){tdId=$td.attr("id")||event;var _currentPage=p.async.requestData[p.async.pageFieldDefine.currentPage],_isRefresh=false;if(tdId===getFirstPageBtnId.call(_thisElm)){if(_currentPage!==1){_currentPage=1;_isRefresh=true}}if(tdId===getPrevPageBtnId.call(_thisElm)){if(_currentPage>1){_currentPage=_currentPage-1;_isRefresh=true;_thisElm.isPrePageOfKey=(typeof event==="string")}}if(tdId===getNextPageBtnId.call(_thisElm)){if(_currentPage<p.async.requestData[p.async.pageFieldDefine.totalPage]){_currentPage=_currentPage+1;_isRefresh=true;_thisElm.isPrePageOfKey=false}}if(tdId===getLastPageBtnId.call(_thisElm)){if(_currentPage!==p.async.requestData[p.async.pageFieldDefine.totalPage]){_currentPage=p.async.requestData[p.async.pageFieldDefine.totalPage];_isRefresh=true}}if(_isRefresh===true){p.async.requestData[p.async.pageFieldDefine.currentPage]=_currentPage;_onRemote.call(_thisElm)}}}},_onKeyupDataPanel=function(event){},_onSelectRow=function(event,rowId){var _thisElm=this,p=_thisElm.p,$this=$(_thisElm),selector,fieldName,bindFill=p.view.bindFill,rowData=_getRowData.call(_thisElm,rowId),rowIdAttrName=getDataGridRowIdAttributeName.call(_thisElm),$dataGridTrElems=p._dataPanel.find("tr["+rowIdAttrName+"]");p._focusRowIndex=$dataGridTrElems.index(p._dataPanel.find("tr["+rowIdAttrName+"="+rowId+"]"));_setSelectedRowEffect.call(_thisElm,$dataGridTrElems);if(p.callback.beforeSelectRow&&p.callback.beforeSelectRow.call(_thisElm,rowData)===false){return}p.currentSelectedRowId=rowId;if(!$.isEmptyObject(bindFill)){for(selector in bindFill){if(bindFill[selector]){fieldName=bindFill[selector];$(selector).val(rowData[fieldName])}}}if(p.callback.afterSelectRow){p.callback.afterSelectRow.call(_thisElm,rowData)}if(p.view.isRememberValue===true){p._isCurrentValueFromDataGrid=true;p._rememberValue=$this.val()}p.hideDropDown.call(_thisElm)},_buildPagerBarHtml=function(data){var _thisElm=this,p=_thisElm.p;var _compiled=_.template(_getPagerBarHtmlTemplate.call(_thisElm));data.firstPageBtnId=getFirstPageBtnId.call(_thisElm);data.prevPageBtnId=getPrevPageBtnId.call(_thisElm);data.nextPageBtnId=getNextPageBtnId.call(_thisElm);data.lastPageBtnId=getLastPageBtnId.call(_thisElm);data.pagerId=getPagerId.call(_thisElm);data.currentPage=data[p.async.pageFieldDefine.currentPage];data.totalPage=data[p.async.pageFieldDefine.totalPage];data.totalRecord=data[p.async.pageFieldDefine.totalRecord];return _compiled(data)},_getDataGridHtmlTemplate=function(){var _thisElm=this,p=_thisElm.p;if(p.view.dataGridHtmlTemplate){return p.view.dataGridHtmlTemplate}else{return _buildDataGridHtmlTemplate.call(_thisElm)}},_buildDataGridHtmlTemplate=function(){var _thisElm=this,p=_thisElm.p,i,cm,cms=p.view.colModels,showFieldNames=p._showFieldNames,rowIdAttrName=getDataGridRowIdAttributeName.call(_thisElm),rowIdPropertyName=getDataRowIdPropertyName.call(_thisElm),dataGridHeadId=getDataGridHeadId.call(_thisElm),dataGridId=getDataGridId.call(_thisElm),_tableTemplate="",tdStyle="";if((!p.view.singleColumnNotHead||showFieldNames.length>1)&&(!p.view.forceHideHead)){_tableTemplate='<div class="auto-comboBox-dataPanel-heard">';_tableTemplate+='<table id="'+dataGridHeadId+'" class="auto-comboBox-dataPanel-table"><thead><tr>';for(i=0;i<cms.length;i++){cm=cms[i];cm.label=cm.label?cm.label:cm.name;cm.align=cm.align?cm.align:"center";if(cm.isHide===true){_tableTemplate+='<td style="display: none;">'+cm.label+"</td>"}else{tdStyle='style="';if(cm.align){tdStyle+="text-align:center;"}if(cm.width>0){tdStyle+="width:"+cm.width+"px;"}tdStyle+='"';_tableTemplate+='<td isHead colName="'+cm.name+'" '+tdStyle+">"+cm.label+"</td>"}}_tableTemplate+="</tr></thead></table></div>"}_tableTemplate+='<div style="overflow-y:auto;">';_tableTemplate+='<table id="'+dataGridId+'" class="auto-comboBox-dataPanel-table">';_tableTemplate+="<%if(_.size("+p.async.pageFieldDefine.records+")>0){%>";_tableTemplate+="<tbody><%_.each("+p.async.pageFieldDefine.records+", function(r,idx){%>";_tableTemplate+="<tr "+rowIdAttrName+'="<%=r.'+rowIdPropertyName+'%>">';for(i=0;i<cms.length;i++){cm=cms[i];if(cm.isHide===true){_tableTemplate+='<td style="display: none;"><%=r.'+cm.name+"%></td>"}else{tdStyle='style="';if(cm.align){tdStyle+="text-align:"+cm.align+";"}if(cm.width>0){tdStyle+="width:"+cm.width+"px;"}tdStyle+='"';_tableTemplate+='<td colName="'+cm.name+'" '+tdStyle+"><%=r."+cm.name+"%></td>"}}_tableTemplate+="</tr><%});%>";_tableTemplate+="</tbody>";_tableTemplate+="<%}else{%>";_tableTemplate+='<tbody><tr><td style="border-width: 0;">'+$.autoCombo.i18n.emptyRecordsHtml+"</td></tr></tbody>";_tableTemplate+="<%}%>";_tableTemplate+="</table></div>";p.view.dataGridHtmlTemplate=_tableTemplate;return p.view.dataGridHtmlTemplate},_buildDataGridHtml=function(data){var _thisElm=this,p=_thisElm.p,records,rowData,k,key,_compiled=_.template(_getDataGridHtmlTemplate.call(_thisElm)),_tempData=$.extend(true,{},data);if(p.view.isEncode){records=_tempData[p.async.pageFieldDefine.records];for(k=records.length-1;k>=0;k--){rowData=records[k];for(key in rowData){rowData[key]=_encode(rowData[key])}}}return _compiled(_tempData)},_getPagerBarHtmlTemplate=function(){var _thisElm=this,p=_thisElm.p;return p.view.pagerBarHtmlTemplate},_resizeDropDown=function(){return $(this).each(function(){var _thisElm=this,p=_thisElm.p,view=p.view,async=p.async;if(view.dropDownContainer===null){if(async.dataSourceType===_dataSourceType.l){_resizeForLocal.call(_thisElm,false)}if(async.dataSourceType===_dataSourceType.o){_resizeForOnceRemote.call(_thisElm,false)}if(async.dataSourceType===_dataSourceType.r){_resizeForRemote.call(_thisElm,false)}}else{if(async.dataSourceType===_dataSourceType.l){_resizeForLocal.call(_thisElm,true)}if(async.dataSourceType===_dataSourceType.o){_resizeForOnceRemote.call(_thisElm,true)}if(async.dataSourceType===_dataSourceType.r){_resizeForRemote.call(_thisElm,true)}}})},_resizeForLocal=function(hasDropDownContainer){var _thisElm=this,p=_thisElm.p,minusHeight,$dataGrid=$("#"+getDataGridId.call(_thisElm)),$dataGridHead=$("#"+getDataGridHeadId.call(_thisElm)),view=p.view,dropDownWidth=0,dataGridParentHeight=0,realRowTotalHeight;if(view.widthRefer!=null){dropDownWidth=_getWidthRefer.call(_thisElm)}else{if(view.width!=0){dropDownWidth=view.width}else{dropDownWidth=p._totalColWidth}}p._dropDown.width(dropDownWidth);_resizeColWidth.call(_thisElm,dropDownWidth);minusHeight=$dataGridHead.outerHeight();minusHeight=minusHeight>=0?minusHeight:0;realRowTotalHeight=_getRealRowTotalHeight.call(_thisElm);if(view.height!=0){if((realRowTotalHeight+minusHeight)>=view.height){dataGridParentHeight=view.height-minusHeight}else{dataGridParentHeight=realRowTotalHeight}}else{if((realRowTotalHeight+minusHeight)>=p._maxHeight){dataGridParentHeight=p._maxHeight-minusHeight}else{dataGridParentHeight=realRowTotalHeight}}if(p._dropDown.height()==0&&hasDropDownContainer){p._dropDown.height(dataGridParentHeight+minusHeight)}$dataGrid.parent().height(dataGridParentHeight)},_resizeForOnceRemote=function(hasDropDownContainer){var _thisElm=this,p=_thisElm.p,minusHeight,$dataGrid=$("#"+getDataGridId.call(_thisElm)),$dataGridHead=$("#"+getDataGridHeadId.call(_thisElm)),view=p.view,dropDownWidth=0,dataGridParentHeight=0,realRowTotalHeight;if(view.widthRefer!=null){dropDownWidth=_getWidthRefer.call(_thisElm)}else{if(view.width!=0){dropDownWidth=view.width}else{dropDownWidth=p._totalColWidth}}p._dropDown.width(dropDownWidth);_resizeColWidth.call(_thisElm,dropDownWidth);minusHeight=$dataGridHead.outerHeight();minusHeight=minusHeight>=0?minusHeight:0;realRowTotalHeight=_getRealRowTotalHeight.call(_thisElm);if(view.height!=0){if((realRowTotalHeight+minusHeight)>=view.height){dataGridParentHeight=view.height-minusHeight}else{dataGridParentHeight=realRowTotalHeight}}else{if((realRowTotalHeight+minusHeight)>=p._maxHeight){dataGridParentHeight=p._maxHeight-minusHeight}else{dataGridParentHeight=realRowTotalHeight}}if(p._dropDown.height()==0&&hasDropDownContainer){p._dropDown.height(dataGridParentHeight+minusHeight)}$dataGrid.parent().height(dataGridParentHeight)},_resizeForRemote=function(hasDropDownContainer){var _thisElm=this,p=_thisElm.p,minusHeight,$dataGrid=$("#"+getDataGridId.call(_thisElm)),$dataGridHead=$("#"+getDataGridHeadId.call(_thisElm)),$pager=$("#"+getPagerId.call(_thisElm)),view=p.view,dropDownWidth=0,dataGridParentHeight=0,realRowTotalHeight;if(view.widthRefer!=null){dropDownWidth=_getWidthRefer.call(_thisElm)}else{if(view.width!=0){dropDownWidth=view.width}else{dropDownWidth=p._totalColWidth}}if(view.showPager){if(dropDownWidth<=p.view.minWidth){dropDownWidth=p.view.minWidth}}p._dropDown.width(dropDownWidth);_resizeColWidth.call(_thisElm,dropDownWidth);minusHeight=$dataGridHead.outerHeight();minusHeight=minusHeight>=0?minusHeight:0;minusHeight+=$pager.outerHeight();minusHeight=minusHeight>=0?minusHeight:0;realRowTotalHeight=_getRealRowTotalHeight.call(_thisElm);if(view.height!=0){if(!hasDropDownContainer){if((realRowTotalHeight+minusHeight)>=view.height){dataGridParentHeight=view.height-minusHeight}else{dataGridParentHeight=realRowTotalHeight}}else{dataGridParentHeight=view.height-minusHeight}}else{if(!hasDropDownContainer){if((realRowTotalHeight+minusHeight)>=p._maxHeight){dataGridParentHeight=p._maxHeight-minusHeight}else{dataGridParentHeight=realRowTotalHeight}}else{dataGridParentHeight=p._maxHeight-minusHeight}}if(p._dropDown.height()==0&&hasDropDownContainer){p._dropDown.height(dataGridParentHeight+minusHeight)}$dataGrid.parent().height(dataGridParentHeight)},_getRealRowTotalHeight=function(){var _thisElm=this,p=_thisElm.p,$dataGridTrs,rowIdAttrName,totalRowHeight=0;rowIdAttrName=getDataGridRowIdAttributeName.call(_thisElm);$dataGridTrs=p._dataPanel.find("tr["+rowIdAttrName+"]");if($dataGridTrs&&$dataGridTrs.length>0){$dataGridTrs.each(function(index,elm){totalRowHeight+=$(elm).outerHeight()});totalRowHeight=(totalRowHeight+1)}else{totalRowHeight=$("table",p._dataPanel).height()}return totalRowHeight},_resizeColWidth=function(totalWidth){var _thisElm=this,p=_thisElm.p,colModel,i,view=p.view;for(i=0;i<view.colModels.length;i++){colModel=view.colModels[i];if(colModel.isHide!==true){colModel.width=colModel._widthRatio*totalWidth;$('[colName="'+colModel.name+'"]',p._dropDown).css({width:colModel.width+"px"})}}},getFirstPageBtnId=function(){return this.p.id+"FirstPageBtn"},getPrevPageBtnId=function(){return this.p.id+"PrevPageBtn"},getNextPageBtnId=function(){return this.p.id+"NextPageBtn"},getLastPageBtnId=function(){return this.p.id+"LastPageBtn"},getPagerId=function(){return this.p.id+"Pager"},getDataGridHeadId=function(){return this.p.id+"DataGridHead"},getDataGridId=function(){return this.p.id+"DataGrid"},getDataGridRowIdAttributeName=function(){return"_row_id"},getDataRowIdPropertyName=function(){return"_rowId"},_getPositionRefer=function(){var _thisElm=this,$this=$(_thisElm),p=_thisElm.p,_positionRefer=p.view.positionRefer,$positionRefer;if($.isFunction(_positionRefer)){$positionRefer=_positionRefer.call(_thisElm);$positionRefer=($positionRefer&&$positionRefer.length>0)?$positionRefer:$this}else{$positionRefer=$(_positionRefer);$positionRefer=($positionRefer&&$positionRefer.length>0)?$positionRefer:$this}return $positionRefer},_getWidthRefer=function(){var _thisElm=this,p=_thisElm.p,_widthRefer=p.view.widthRefer;if($.isFunction(_widthRefer)){return _widthRefer.call(_thisElm)}else{return _widthRefer}},_getRowData=function(rowId){var _thisElm=this,p=_thisElm.p,ods={},rowIdPropertyName=getDataRowIdPropertyName.call(_thisElm);for(var i=0;i<p._originalDataStore.length;i++){var _ods=p._originalDataStore[i];if(_ods[rowIdPropertyName]===rowId){ods=_ods;break}}if($.isEmptyObject(ods)){}return ods},_setSelectedFirstRow=function(isLast){var _thisElm=this,p=_thisElm.p,rowIdAttrName=getDataGridRowIdAttributeName.call(_thisElm),rowNum=0;if(p.view.isSelectedFirstRow===true){var $dataGridTrElems=p._dataPanel.find("tr["+rowIdAttrName+"]");if($dataGridTrElems&&$dataGridTrElems.length>0){if(p.currentSelectedRowId&&p.view.dropDownContainer){_setSelectedRowEffect.call(_thisElm,$dataGridTrElems);return}if(!_thisElm.value||p._rememberValue!==_thisElm.value){rowNum=isLast?p._originalDataStore.length-1:0;p._focusRowIndex=rowNum}_setSelectedRowEffect.call(_thisElm,$dataGridTrElems);if(p.view.isSelectedFirstRowAction===true){var $trElem=p._dataPanel.find("tr.selected["+rowIdAttrName+"]");_onSelectRow.call(_thisElm,event,$trElem.attr(rowIdAttrName))}}}},_reloadByValue=function(filterValue){var _thisElm=this,p=_thisElm.p,filterStore={},formatStore={},$dp=p._dataPanel,dataGridHtml="",_filterValue=filterValue?filterValue:"";switch(p.async.dataSourceType){case _dataSourceType.r:p.async.requestData[p.input.inputQueryParamName]=_filterValue;_onRemote.call(_thisElm);break;case _dataSourceType.o:case _dataSourceType.l:var _recStore={};if(p._isSettedLocalData||(p._originalDataStore.length===0&&p.view.localData.length>0)){if(p._originalDataStore.length>0){p.view.localData=$.extend(true,[],p._originalDataStore)}p._originalDataStore=$.extend(true,[],p.view.localData);_setRowId.call(_thisElm,p._originalDataStore)}_recStore[p.async.pageFieldDefine.records]=p._originalDataStore;filterStore=_format.call(_thisElm,_recStore);formatStore=_getFilterRowDatas.call(_thisElm,_filterValue,filterStore);dataGridHtml=_buildDataGridHtml.call(_thisElm,formatStore);$dp.empty().append(dataGridHtml);if(p.view.isHighlight){_setHighlightEffect.call(_thisElm,_filterValue)}p.hideLoadingBar.call(_thisElm);if(p._justReload===false){p.showDropDown.call(_thisElm,true)}else{p._justReload=false}_setSelectedFirstRow.call(_thisElm);p._isLoaded=true;break}},_getFilterRowDatas=function(inputValue,dataStore){var _thisElm=this,p=_thisElm.p,i=0,j=0,filterRowDatas=[],filterFieldName,rowData={},inputFilterFieldNames=_getInputFilterFieldNames.call(_thisElm),tempStore=$.extend(true,{},dataStore),tempDatas=$.autoCombo.getAccessor(tempStore,p.async.pageFieldDefine.records);if(inputValue.length>0&&inputFilterFieldNames.length>0){for(;i<tempDatas.length;i++){rowData=tempDatas[i];if(!$.isEmptyObject(rowData)){for(j=0;j<inputFilterFieldNames.length;j++){filterFieldName=inputFilterFieldNames[j];if($.trim(rowData[filterFieldName])&&($.trim(rowData[filterFieldName])).toLowerCase().indexOf(inputValue.toLowerCase())>-1){filterRowDatas.push(rowData);break}}}}tempStore[p.async.pageFieldDefine.records]=filterRowDatas}else{tempStore=dataStore}return tempStore},_setHighlightEffect=function(matchStr){var _thisElm=this,p=_thisElm.p,regExp=new RegExp(/\//g),regExp1=new RegExp(/\'/g),regExp2,matchArr=[],i;matchStr=matchStr.replace(regExp,"\\/");matchStr=matchStr.replace(regExp1,"\\'");regExp=eval("new RegExp('/"+matchStr+"/gi');");$("td",p._dataPanel).each(function(ind,elm){var $td=$(elm),text;if($td&&$td.length>0){text=$td.text();if($.trim(text).length>0){if($.isArray(text.match(regExp))&&text.match(regExp).length>0){matchArr=text.match(regExp);matchArr=_.uniq(matchArr);for(i=0;i<matchArr.length;i++){regExp2=eval("/"+matchArr[i]+"/g");text=text.replace(regExp2,"+_)(*&^%$#@!~"+matchArr[i]+"~!@#$%^&*()_+")}regExp2=eval("/\\+\\_\\)\\(\\*\\&\\^\\%\\$\\#\\@\\!\\~/g");text=text.replace(regExp2,"<span class='match'>");regExp2=eval("/\\~\\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\_\\+/g");text=text.replace(regExp2,"</span>");$td.html(text)}}}})},_getInputFilterFieldNames=function(){var _thisElm=this,p=_thisElm.p,i=0,colModel={};if(p._inputFilterFieldNames.length>0){}else{p._inputFilterFieldNames=[];for(;i<p.view.colModels.length;i++){colModel=p.view.colModels[i];if(colModel.isInputFilter===false){continue}if(colModel.isInputFilter||colModel.isHide!==true){p._inputFilterFieldNames.push(colModel.name)}}}return p._inputFilterFieldNames},_calculateInfo=function(){var _thisElm=this,p=_thisElm.p,i,colModel={};p._showFieldNames=[];p._formatterMap={};for(i=0;i<p.view.colModels.length;i++){p.view.colModels[i]=$.extend(true,{},_defaultColModel,p.view.colModels[i]);colModel=p.view.colModels[i];if(colModel.isHide!==true){p._showFieldNames.push(colModel.name);p._totalColWidth+=colModel.width}if(colModel.formatter){p._formatterMap[colModel.name]=colModel.formatter}}for(i=0;i<p.view.colModels.length;i++){colModel=p.view.colModels[i];if(colModel.isHide!==true){colModel._widthRatio=(colModel.width/p._totalColWidth)}}if(p.view.height===0){if(p.view.autoHeightPadding>-1&&p.view.dropDownContainer){p.view.height=$.oui.utils.element.getHeightToBottom(p.view.dropDownContainer,p.view.autoHeightPadding)}}},_setSelectedRowEffect=function($dataGridTrs){var _thisElm=this,p=_thisElm.p,$focusRowTr,$dataGridParent,totalHeight=0;$dataGridTrs.css({"background-color":""}).removeClass("selected");$focusRowTr=$($dataGridTrs[p._focusRowIndex]);$focusRowTr.addClass("selected");$dataGridParent=$("#"+getDataGridId.call(_thisElm)).parent();$($dataGridTrs).each(function(index,elm){if(p._focusRowIndex>index){totalHeight+=$(elm).height()}});$dataGridParent[0].scrollTop=totalHeight},_showCurrentSelectedRow=function(){var _thisElm=this,p=_thisElm.p,rowIdAttrName=getDataGridRowIdAttributeName.call(_thisElm),$dataGridTrs=p._dataPanel.find("tr["+rowIdAttrName+"]"),focusRowIndex;if(p._focusRowIndex<0){focusRowIndex=-1;if($dataGridTrs&&$dataGridTrs.length>0){for(var i=0;i<$dataGridTrs.length;i++){if($dataGridTrs[i].innerText===_thisElm.value){focusRowIndex=i;break}}}p._focusRowIndex=focusRowIndex}_setSelectedRowEffect.call(_thisElm,$dataGridTrs)},_format=function(store){var _thisElm=this,p=_thisElm.p,dataStore=$.extend(true,{},store),records=dataStore[p.async.pageFieldDefine.records],rowData,i,fieldName,formatterName;if($.isEmptyObject(p._formatterMap)){return store}if(dataStore&&records&&records.length>0){for(i=0;i<records.length;i++){rowData=records[i];for(fieldName in p._formatterMap){if(!p._formatterMap.hasOwnProperty(fieldName)){continue}formatterName=p._formatterMap[fieldName]["name"];if(formatterName==="date"){rowData[fieldName]=_formatDate.call(_thisElm,fieldName,rowData[fieldName],p._formatterMap[fieldName])}if(formatterName==="currency"){rowData[fieldName]=_formatCurrency.call(_thisElm,fieldName,rowData[fieldName],p._formatterMap[fieldName])}if(formatterName==="checkbox"){rowData[fieldName]=_formatCheckbox.call(_thisElm,fieldName,rowData[fieldName],p._formatterMap[fieldName])}}}}return dataStore},_formatDate=function(fieldName,fieldValue,formatConfig){return $.oui.utils.date.format(new Date(fieldValue),(formatConfig.dateFormat||"yyyy-MM-dd"))},_formatCurrency=function(fieldName,fieldValue,formatConfig){return $.oui.utils.number.currency(fieldValue,formatConfig.decimalPlaces,formatConfig.thousandsSeparator,formatConfig.decimalSeparator,formatConfig.prefix,formatConfig.suffix)},_formatCheckbox=function(fieldName,fieldValue,formatConfig){return"<input type='checkbox' disabled "+(fieldValue=="1"?"checked='checked'":+"")+">"},_printInfoLog=function(msg){if(console){if(console.hasOwnProperty("info")){console.info(msg)}else{if(console.hasOwnProperty("log")){console.log(msg)}}}},_printWarnLog=function(msg){if(console){if(console.hasOwnProperty("warn")){console.warn(msg)}else{if(console.hasOwnProperty("log")){console.log(msg)}}}},_encode=function(value){return !value?value:String(value).replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}})(jQuery);var AutoComboboxUtil=AutoComboboxUtil||{render:function(){$("input[componentType='auto-combobox']").each(function(index,inputEl){var $inputEl=$(inputEl),componentConfigName=$inputEl.attr("componentConfig"),componentConfigArg=$inputEl.attr("componentConfigArg"),componentConfigExt=$inputEl.attr("componentConfigExt"),bindFill=$inputEl.attr("bindFill")?JSON.parse($inputEl.attr("bindFill")):{},componentConfig={};if(!componentConfig){return}if($.isFunction(AutoComboboxUtil[componentConfigName])&&componentConfigArg&&$.isArray($.parseJSON(componentConfigArg))){componentConfig=AutoComboboxUtil[componentConfigName].apply(AutoComboboxUtil,$.parseJSON(componentConfigArg))}else{if($.isFunction(AutoComboboxUtil[componentConfigName])){componentConfig=AutoComboboxUtil[componentConfigName].call(AutoComboboxUtil)}else{if($.isPlainObject(AutoComboboxUtil[componentConfigName])){componentConfig=AutoComboboxUtil[componentConfigName]}}}if($.isFunction(eval(componentConfigExt))){componentConfig=$.extend(true,{},componentConfig,{view:{bindFill:bindFill}},eval(componentConfigExt)())}else{componentConfig=$.extend(true,{},componentConfig,{view:{bindFill:bindFill}},eval(componentConfigExt))}$inputEl.attr("autocomplete","off");$inputEl.AutoCombobox(componentConfig)});$("[componentType='auto-combobox-trigger']").each(function(index,elm){var $elm=$(elm),triggerElementId=$elm.attr("triggerElementId");if(triggerElementId){$elm.bind("click",function(event){$("#"+triggerElementId).AutoCombobox("triggerAction",event)})}else{alert("没有配置triggerElementId")}})}};$.extend(true,$.autoCombo,{i18n:{clearButtonTitle:"Clear The Data",emptyRecordsHtml:"No Record!",pageInfoFormat:"Tot <%=totalPage%> pg,Tot <%=totalRecord%> REC"}});